
# üöÄ Project Documentation


> ‚öôÔ∏è **–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:** FastAPI + PostgreSQL + Redis + MinIO  
> üß™ **–¢–µ—Å—Ç—ã:** pytest + Alembic + Docker Compose  
> üß∞ **CI/CD:** GitHub Actions —Å unit + smoke —Ç–µ—Å—Ç–∞–º–∏  
> üß± **–î–µ–ø–ª–æ–π:** —á–µ—Ä–µ–∑ Docker image (production-ready)


–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!  
–≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç ‚Äî backend-—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–æ–º–ø–∞–Ω–∏—è–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏, –ø—Ä–æ–µ–∫—Ç–∞–º–∏, –∑–∞–¥–∞—á–∞–º–∏, —Ñ–∞–π–ª–∞–º–∏ –∏ –ø–æ–¥–ø–∏—Å–∫–∞–º–∏.  

–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è 1—Å–¥–µ–ª–∞–Ω–∞ —Ç–∞–∫, —á—Ç–æ–±—ã —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫ (–¥–∞–∂–µ –Ω–æ–≤–∏—á–æ–∫) –º–æ–≥ **–ø–æ–¥–Ω—è—Ç—å –ø—Ä–æ–µ–∫—Ç –∑–∞ 10 –º–∏–Ω—É—Ç** –∏ –±—ã—Å—Ç—Ä–æ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –≤ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–µ.  

---

## üìë –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
- [üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞](#-–∑–∞–ø—É—Å–∫-–ø—Ä–æ–µ–∫—Ç–∞)
- [üóÑÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤](#Ô∏è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-—Å–µ—Ä–≤–∏—Å–æ–≤)
- [üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–æ–∫—Ä—É–∂–µ–Ω–∏–π)
- [üß≠ –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π](#-—Å—Ö–µ–º–∞-–ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è-–æ–∫—Ä—É–∂–µ–Ω–∏–π)
- [üìå –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π](#-–ø—Ä–æ–≤–µ—Ä–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è)  
- [üìä ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ –±–∞–∑—ã](#-er-–¥–∏–∞–≥—Ä–∞–º–º–∞-–±–∞–∑—ã)
- [üîê –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø—ã](#-—Ä–æ–ª–∏-–∏-–¥–æ—Å—Ç—É–ø—ã)
- [üí≥ –ü–æ–¥–ø–∏—Å–∫–∏ –∏ –±–∏–ª–ª–∏–Ω–≥](#-–ø–æ–¥–ø–∏—Å–∫–∏-–∏-–±–∏–ª–ª–∏–Ω–≥)
- [üìå –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã](#-–ø–æ–ª–µ–∑–Ω—ã–µ-–∫–æ–º–∞–Ω–¥—ã)
- [üõ†Ô∏è –î–µ–ø–ª–æ–π —á–µ–∫–ª–∏—Å—Ç](#Ô∏è-–¥–µ–ø–ª–æ–π-—á–µ–∫–ª–∏—Å—Ç)
- [üìò CI/CD Pipeline](#-ci-cd-pipeline)
- [‚ö° –ú–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)](#-–º–∏–≥—Ä–∞—Ü–∏–∏-alembic)
- [üêã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL](#-–∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è-postgresql)  
- [üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)


---

## üöÄ –ó–∞–ø—É—Å–∫ –ø—Ä–æ–µ–∫—Ç–∞

```bash
# –ö–ª–æ–Ω–∏—Ä—É–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
git clone <repo_url>
cd <repo_name>

# –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º –æ–∫—Ä—É–∂–µ–Ω–∏–µ
cp .env.example .env

# –°–±–æ—Ä–∫–∞ –∏ –∑–∞–ø—É—Å–∫
make build
make up
````

–ü–æ—Å–ª–µ —Å—Ç–∞—Ä—Ç–∞ —Å–µ—Ä–≤–∏—Å –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
üëâ [http://localhost:8000](http://localhost:8000)

---

## üóÑÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å–µ—Ä–≤–∏—Å–æ–≤

* **FastAPI** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π backend
* **PostgreSQL** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
* **Alembic** ‚Äî –º–∏–≥—Ä–∞—Ü–∏–∏
* **Docker + docker-compose** ‚Äî –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
* **S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ** ‚Äî —Ñ–∞–π–ª—ã –∏ –≤–ª–æ–∂–µ–Ω–∏—è
* **JWT + refresh-—Ç–æ–∫–µ–Ω—ã** ‚Äî –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è

```mermaid
flowchart TD
    Client --> API
    API --> DB[(PostgreSQL)]
    API --> Storage[(S3 Bucket)]
    API --> Auth[(JWT / Sessions)]
```


---


## üß© –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π –∏ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤

–ü—Ä–æ–µ–∫—Ç —Ä–∞–∑–¥–µ–ª—ë–Ω –Ω–∞ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:

| –û–∫—Ä—É–∂–µ–Ω–∏–µ | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û–ø–∏—Å–∞–Ω–∏–µ |
|------------|-------------|----------|
| **Local** | –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ | –†–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ `docker compose`, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `.env` |
| **Test** | –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –∏ CI | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `.env.test` –∏ –≤—Ä–µ–º–µ–Ω–Ω—É—é –±–∞–∑—É `saasdb_test` |
| **CI/CD** | GitHub Actions | –ü–æ–¥–Ω–∏–º–∞–µ—Ç –æ–∫—Ä—É–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Docker Compose –∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç smoke-—Ç–µ—Å—Ç—ã |
| **Production** | –ü—Ä–æ–¥–∞–∫—à–µ–Ω | –ò—Å–ø–æ–ª—å–∑—É–µ—Ç `.env.production` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –∏–∑ —Å–µ–∫—Ä–µ—Ç–∞ |

---

### üß† –õ–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤

```mermaid
flowchart TD
    subgraph App_Container["üß© saas_bot (FastAPI / aiogram)"]
      BOT -->|asyncpg| POSTGRES[(PostgreSQL main)]
      BOT -->|redis-py| REDIS[(Redis cache)]
      BOT -->|boto3| MINIO[(S3 MinIO)]
      BOT -->|psycopg2| ALEMBIC[(Alembic migrations)]
      BOT -->|pytest| TEST_DB[(PostgreSQL test)]
    end

    subgraph CI_Pipeline["‚öôÔ∏è GitHub Actions CI"]
      LINT[Lint / Security] --> UNIT[Unit Tests]
      UNIT --> BUILD[Docker Build]
      BUILD --> SMOKE[Smoke Tests]
    end

    SMOKE --> App_Container
    SMOKE --> POSTGRES
    SMOKE --> REDIS
    SMOKE --> MINIO
```

---

### ‚öôÔ∏è –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –ª–æ–∫–∞–ª—å–Ω–æ

1. **Docker Compose** –ø–æ–¥–Ω–∏–º–∞–µ—Ç –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:
   - `bot` ‚Äî –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
   - `db` ‚Äî –æ—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ PostgreSQL
   - `test_db` ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞
   - `redis` ‚Äî –∫—ç—à
   - `minio` ‚Äî S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–µ –¥–ª—è —Ñ–∞–π–ª–æ–≤

2. **–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è** –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ `.env` –∏ `.env.test`.

3. **–ú–∏–≥—Ä–∞—Ü–∏–∏** –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ `bot` –∫–æ–º–∞–Ω–¥–æ–π:
   ```bash
   docker compose run --rm bot alembic upgrade head
   ```

4. **–¢–µ—Å—Ç—ã** –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ—Ç–¥–µ–ª—å–Ω—É—é —Ç–µ—Å—Ç–æ–≤—É—é –±–∞–∑—É `saasdb_test`, —á—Ç–æ–±—ã –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç—å –ø—Ä–æ–¥–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ.

---

### üß™ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã –≤ CI (GitHub Actions)

1. **Lint / Security** ‚Äî –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—Ç–∏–ª—å –∏ —É—è–∑–≤–∏–º–æ—Å—Ç–∏.  
2. **Unit Tests** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç —Ç–µ—Å—Ç—ã –Ω–∞ —á–∏—Å—Ç–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ Postgres.  
3. **Docker Build** ‚Äî —Å–æ–±–∏—Ä–∞–µ—Ç –∏—Ç–æ–≥–æ–≤—ã–π –æ–±—Ä–∞–∑, –∫–æ—Ç–æ—Ä—ã–π –ø–æ—Ç–æ–º –ø–æ–π–¥—ë—Ç –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω.  
4. **Smoke Tests** ‚Äî –∑–∞–ø—É—Å–∫–∞–µ—Ç `docker compose` –≤–Ω—É—Ç—Ä–∏ CI, –ø—Ä–∏–º–µ–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –∏ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç, —á—Ç–æ –æ–±—Ä–∞–∑ —Ä–µ–∞–ª—å–Ω–æ —Ä–∞–±–æ—Ç–∞–µ—Ç.  

> üí° –û—Ç—á—ë—Ç—ã –æ —Ç–µ—Å—Ç–∞—Ö (HTML + JUnit XML) —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç—ã GitHub Actions.

---

### üß± –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å

| –ö—Ä–∏—Ç–µ—Ä–∏–π | –û—Ü–µ–Ω–∫–∞ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|-----------|--------|--------------|
| –ò–∑–æ–ª—è—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π | ‚úÖ | `.env`, `.env.test`, `.env.ci` –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã |
| –ü–æ–≤—Ç–æ—Ä—è–µ–º–æ—Å—Ç—å —Å–±–æ—Ä–æ–∫ | ‚úÖ | –í—Å–µ —Å—Ç–∞–¥–∏–∏ CI –∏—Å–ø–æ–ª—å–∑—É—é—Ç –æ–¥–Ω–∏ –∏ —Ç–µ –∂–µ Docker-–∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã |
| –ú–∏–≥—Ä–∞—Ü–∏–∏ | ‚úÖ | Alembic —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω, —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä |
| –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | –ü–µ—Ä–µ—Ö–æ–¥ –Ω–∞ Kubernetes –≤–æ–∑–º–æ–∂–µ–Ω –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π –∫–æ–¥–∞ |
| –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫ | ‚öôÔ∏è –ü–æ—á—Ç–∏ | –ú–æ–∂–Ω–æ –≤—ã–Ω–µ—Å—Ç–∏ –æ–±—â–∏–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≤ `.env.shared` |
| –û—Ç–ª–∞–¥–∫–∞ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ | ‚úÖ | `pytest` –∏ `smoke-tests` –¥–∞—é—Ç –ø–æ–ª–Ω—ã–π —Ü–∏–∫–ª –ø—Ä–æ–≤–µ—Ä–∫–∏ |

---

### üìÇ –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

| –§–∞–π–ª | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|------|-------------|
| `.env` | –ª–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è `docker-compose` |
| `.env.test` | –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–µ—Å—Ç–æ–≤–æ–π –±–∞–∑—ã |
| `.env.ci` | –æ–∫—Ä—É–∂–µ–Ω–∏–µ CI/CD |
| `docker-compose.yml` | –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (db, redis, minio, bot) |
| `.github/workflows/ci.yml` | –ø–∞–π–ø–ª–∞–π–Ω GitHub Actions |
| `Dockerfile` | —Å–±–æ—Ä–∫–∞ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –æ–±—Ä–∞–∑–∞ |
| `alembic.ini` / `migrations/` | –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö |



---


### üß≠ –°—Ö–µ–º–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–π

```mermaid
flowchart TD
    subgraph Dev["üß© Local Development"]
        BOT_DEV["bot (FastAPI)"] --> DB_DEV["PostgreSQL (db:5432)"]
        BOT_DEV --> REDIS["Redis"]
        BOT_DEV --> MINIO["MinIO (S3)"]
    end

    subgraph Tests["üß™ Local Tests / CI"]
        PYTEST["pytest"] --> TEST_DB["PostgreSQL (test_db:5432, tmpfs)"]
        PYTEST --> REDIS
        PYTEST --> MINIO
    end

    subgraph CI["‚öôÔ∏è GitHub Actions CI/CD"]
        LINT["Lint & Security"] --> UNIT["Unit Tests (localhost DB)"]
        UNIT --> BUILD["Docker Build"]
        BUILD --> SMOKE["Smoke Tests (docker compose)"]
    end

    CI --> Tests
    CI --> Dev
```

#### üîπ Dev (—Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞)

* –ë–∞–∑–∞: `db:5432`
* –ö–æ–Ω—Ñ–∏–≥: `.env`
* –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã: `bot`, `worker`, `db`, `redis`, `minio`

#### üîπ Test (pytest)

* –ë–∞–∑–∞: `test_db:5432`
* –ö–æ–Ω—Ñ–∏–≥: `.env.test`
* –î–∞–Ω–Ω—ã–µ –Ω–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è (`tmpfs`)

#### üîπ CI/CD (GitHub Actions)

* –õ–∏–Ω—Ç, —é–Ω–∏—Ç-—Ç–µ—Å—Ç—ã, smoke-—Ç–µ—Å—Ç—ã
* –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –∏–∑ `.env.ci`
* –§–∏–Ω–∞–ª—å–Ω—ã–π Docker-–æ–±—Ä–∞–∑ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞ –∑–∞–ø—É—Å–∫




---

## üß± –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏–π

–≠—Ç–æ—Ç —Ä–∞–∑–¥–µ–ª –ø–æ–º–æ–≥–∞–µ—Ç —É–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ –∫–∞–∂–¥–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ.
–°–ª–µ–¥—É—é—â–∏–µ –∫–æ–º–∞–Ω–¥—ã –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω—è—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ, –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞—Ö –∏–ª–∏ –≤ CI.


### üîπ 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ dev-–æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ü–µ—Ä–µ—Å–æ–±—Ä–∞—Ç—å –∏ –ø–æ–¥–Ω—è—Ç—å –æ–∫—Ä—É–∂–µ–Ω–∏–µ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
make build
make up

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ dev-–±–∞–∑–µ
docker compose exec db psql -U saasuser -d saasdb -c '\dt'

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –±–æ—Ç –∑–∞–ø—É—â–µ–Ω
make logs
```

‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

* –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä `saasbot` –≤ —Å—Ç–∞—Ç—É—Å–µ *running*
* –≤ –ª–æ–≥–∞—Ö –≤–∏–¥–Ω–æ `BOT_TOKEN: dummy...`
* —Ç–∞–±–ª–∏—Ü—ã –≤ `saasdb` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É—é—Ç –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–π

---

### üîπ 2. –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```bash
# –ó–∞–ø—É—Å–∫ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ —Å –≤—Ä–µ–º–µ–Ω–Ω–æ–π –±–∞–∑–æ–π
make tloc
```

‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

* –±–∞–∑–∞ `saasdb_test` —Å–æ–∑–¥–∞—ë—Ç—Å—è –≤–æ –≤—Ä–µ–º–µ–Ω–Ω–æ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–µ `test_db`
* pytest –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç `5 passed in ...s`
* –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏–µ –æ—á–∏—â–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

> üí° –¢–µ—Å—Ç—ã –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ —Ç—Ä–æ–≥–∞—é—Ç dev-–±–∞–∑—É ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∏–∑ `.env.test`.

---

### üîπ 3. –ü—Ä–æ–≤–µ—Ä–∫–∞ CI/CD –ø–∞–π–ø–ª–∞–π–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ (—ç–º—É–ª—è—Ü–∏—è)

```bash
# –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –ø–∞–π–ø–ª–∞–π–Ω –º–æ–∂–Ω–æ –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ
act -j smoke-tests
```

> –ï—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω [**nektos/act**](https://github.com/nektos/act),
> –∫–æ–º–∞–Ω–¥–∞ –ø—Ä–æ–≥–æ–Ω–∏—Ç GitHub Actions –ø—Ä—è–º–æ –Ω–∞ —Ç–≤–æ–µ–π –º–∞—à–∏–Ω–µ.

‚úÖ –û–∂–∏–¥–∞–µ–º—ã–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç:

* –ø—Ä–æ—Ö–æ–¥—è—Ç lint, unit, smoke —Ç–µ—Å—Ç—ã
* —Å–æ–∑–¥–∞—ë—Ç—Å—è –∞—Ä—Ç–µ—Ñ–∞–∫—Ç `smoke-test-results/`

---

### ‚öôÔ∏è –ò—Ç–æ–≥–æ–≤–æ–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–π

| –¢–∏–ø –æ–∫—Ä—É–∂–µ–Ω–∏—è | –§–∞–π–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ | –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö   | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ                   |
| ------------- | ----------------- | ------------- | ---------------------------- |
| Local Dev     | `.env`            | `saasdb`      | –û—Å–Ω–æ–≤–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞          |
| Local Test    | `.env.test`       | `saasdb_test` | –ò–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ pytest-—Ç–µ—Å—Ç—ã   |
| CI/CD         | `.env.ci`         | `saasdb_test` | Smoke –∏ unit —Ç–µ—Å—Ç—ã –≤ Actions |
| Production    | `.env.production` | `saasdb`      | –†–∞–±–æ—á–∞—è —Å—Ä–µ–¥–∞                |




---

## üìä ER-–¥–∏–∞–≥—Ä–∞–º–º–∞ –±–∞–∑—ã

```mermaid
erDiagram
    USERS ||--o{ TASKS : "assigned"
    USERS ||--o{ FILES : "uploaded"
    USERS ||--o{ SESSIONS : "sessions"

    COMPANIES ||--o{ USERS : "members"
    COMPANIES ||--o{ PROJECTS : "projects"
    COMPANIES ||--o{ TASKS : "tasks"
    COMPANIES ||--o{ FILES : "files"
    COMPANIES ||--o{ SUBSCRIPTIONS : "subscriptions"
    COMPANIES ||--o{ TRIALS : "trials"
    COMPANIES ||--o{ INVOICES : "invoices"

    PROJECTS ||--o{ TASKS : "tasks"
    TASKS ||--o{ FILES : "attachments"

    PLANS ||--o{ SUBSCRIPTIONS : "subscriptions"
    PLANS ||--o{ INVOICES : "invoices"
    INVOICES ||--o{ PAYMENTS : "payments"

    USERS ||--o{ AUDIT_LOGS : "actions"
```

---

## üîê –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø—ã

* **Admin** ‚Äî –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º –¥–∞–Ω–Ω—ã–º –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º.
* **Manager** ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞–º–∏, –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏ –∫–æ–º–ø–∞–Ω–∏–∏.
* **Worker** ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á, –∑–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤.
* **Client** ‚Äî –ø—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ–µ–∫—Ç–æ–≤ –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö —Ä–∞–±–æ—Ç.

üìö –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [docs/roles.md](docs/roles.md)

---

## üí≥ –ü–æ–¥–ø–∏—Å–∫–∏ –∏ –±–∏–ª–ª–∏–Ω–≥

* **Trial** ‚Äî –±–µ—Å–ø–ª–∞—Ç–Ω—ã–π –ø—Ä–æ–±–Ω—ã–π –ø–µ—Ä–∏–æ–¥.
* **Subscription** ‚Äî –ø–ª–∞—Ç–Ω–∞—è –ø–æ–¥–ø–∏—Å–∫–∞ (–ø—Ä–∏–≤—è–∑–∫–∞ –∫ –ø–ª–∞–Ω—É).
* **Invoice** ‚Äî —Å—á–µ—Ç –∫–æ–º–ø–∞–Ω–∏–∏.
* **Payment** ‚Äî –æ–ø–ª–∞—Ç–∞ –ø–æ —Å—á–µ—Ç—É.

üìö –ü–æ–¥—Ä–æ–±–Ω–µ–µ: [docs/db\_cascades.md](docs/db_cascades.md)

---

## üìå –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
make build      # —Å–æ–±—Ä–∞—Ç—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã
make up         # –∑–∞–ø—É—Å—Ç–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
make down       # –æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ø—Ä–æ–µ–∫—Ç
make logs       # –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –ª–æ–≥–∏
make shell      # –ø–æ–ø–∞—Å—Ç—å –≤–Ω—É—Ç—Ä—å –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
make migrate    # –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
make revision   # —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
```

---

## üõ†Ô∏è –î–µ–ø–ª–æ–π —á–µ–∫–ª–∏—Å—Ç

* [ ] –û–±–Ω–æ–≤–∏—Ç—å `.env`
* [ ] –ü—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ (`make migrate`)
* [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ–¥–ø–∏—Å–æ–∫ –∏ —Ç—Ä–∏–∞–ª–æ–≤
* [ ] –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–∞–±–æ—Ç—É S3-—Ö—Ä–∞–Ω–∏–ª–∏—â–∞
* [ ] –ü—Ä–æ–≥–Ω–∞—Ç—å —Ç–µ—Å—Ç—ã –ø–µ—Ä–µ–¥ —Ä–µ–ª–∏–∑–æ–º


---

## üìò CI/CD Pipeline

### üéØ –ß—Ç–æ —Ç–µ—Å—Ç–∏—Ä—É–µ—Ç—Å—è –≤ –ø–∞–π–ø–ª–∞–π–Ω–µ

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –µ–¥–∏–Ω—ã–π workflow **CI Pipeline**:

* **Lint**: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (ruff, black, flake8, bandit, safety)
* **Unit tests**: —Ç–µ—Å—Ç—ã –≤ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–Ω–æ–º Postgres (service container), –ø–æ–∫—Ä—ã—Ç–∏–µ —á–µ—Ä–µ–∑ pytest + coverage
* **Smoke tests**: –±–∞–∑–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ —Ä–∞–±–æ—Ç—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### üîÑ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –æ–∫—Ä—É–∂–µ–Ω–∏—è

* **.env** ‚Äî –±–∞–∑–æ–≤–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è docker-compose
* **.env.local** ‚Äî –ª–æ–∫–∞–ª—å–Ω—ã–µ —Å–µ–∫—Ä–µ—Ç—ã (—Ç–æ–∫–µ–Ω—ã, –∫–ª—é—á–∏)
* **.env.ci** ‚Äî —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è CI/CD




---

## ‚ö° –ú–∏–≥—Ä–∞—Ü–∏–∏ (Alembic)

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π Alembic** –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL.
–≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å `async SQLAlchemy` –∏ –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å –ø–µ—Ä–µ–¥–µ–ª–∫–∏ —Å—Ö–µ–º—ã –≤ –±—É–¥—É—â–µ–º.

### üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –º—ã –≤–Ω–µ—Å–ª–∏:

1. **–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥–≤–∏–∂–æ–∫**
```python
from sqlalchemy.ext.asyncio import create_async_engine
connectable = create_async_engine(
 url,
 future=True,
 echo=os.getenv("DEBUG") == "1"
)
```

2. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ–∫—Ä—É–∂–µ–Ω–∏–π**
* –ò—Å–ø–æ–ª—å–∑—É–µ–º `ENV=production` –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞
* –õ–æ–∫–∞–ª—å–Ω–æ –∏ –≤ CI –ø–æ–¥—Ö–≤–∞—Ç—ã–≤–∞–µ–º `DATABASE_URL` / `TEST_DATABASE_URL`

3. **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**
```python
logger.setLevel(logging.DEBUG if os.getenv("DEBUG") else logging.INFO)
```

4. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫**
```python
try:
 asyncio.run(run_migrations_online())
except Exception as e:
 logger.critical(f"–ö—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è –æ—à–∏–±–∫–∞ –ø—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –º–∏–≥—Ä–∞—Ü–∏–π: {e}")
 raise
```

5. **alembic.ini**
–í `alembic.ini` —Å—Ç—Ä–æ–∫–∞ `sqlalchemy.url` –æ—Å—Ç–∞–≤–ª–µ–Ω–∞ –ø—É—Å—Ç–æ–π:
```ini
sqlalchemy.url =
```
URL —Ç–µ–ø–µ—Ä—å –≤—Å–µ–≥–¥–∞ –±–µ—Ä—ë—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

---

### üìã –ö–∞–∫ –ø—Ä–∏–º–µ–Ω—è—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏

**–õ–æ–∫–∞–ª—å–Ω–æ:**
```bash
make revision # —Å–æ–∑–¥–∞—Ç—å –Ω–æ–≤—É—é –º–∏–≥—Ä–∞—Ü–∏—é
make migrate # –ø—Ä–∏–º–µ–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏
```

**–í CI:**
* –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è smoke-—Ç–µ—Å—Ç—ã –∏ –º–∏–≥—Ä–∞—Ü–∏–∏
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `TEST_DATABASE_URL`
* –í —Å–ª—É—á–∞–µ –æ—à–∏–±–∫–∏ –º–∏–≥—Ä–∞—Ü–∏–∏ –ø–∞–π–ø–ª–∞–π–Ω –ø–∞–¥–∞–µ—Ç

**–í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ:**
```bash
ENV=production make migrate
```



---


## üêã –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è PostgreSQL

### üìä –û–∫—Ä—É–∂–µ–Ω–∏—è –∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–í –ø—Ä–æ–µ–∫—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è —Ä–∞–∑–Ω—ã–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞–∑–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π:

**–ü—Ä–æ–¥–∞–∫—à–µ–Ω-–æ–∫—Ä—É–∂–µ–Ω–∏–µ:**
* –û—Å–Ω–æ–≤–Ω–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `saasdb`
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω-–±–æ—Ç–µ –∏ –≤–æ—Ä–∫–µ—Ä–µ

**–¢–µ—Å—Ç–æ–≤—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
* –¢–µ—Å—Ç–æ–≤–∞—è –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö: `saasdb_test`
* –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ CI –∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö —Ç–µ—Å—Ç–∞—Ö

### üîÑ –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–î–ª—è –≤—Å–µ—Ö –æ–∫—Ä—É–∂–µ–Ω–∏–π –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ:
* `POSTGRES_USER`
* `POSTGRES_PASSWORD`
* `POSTGRES_HOST`
* `POSTGRES_PORT`
* `POSTGRES_DB`

–¢–∞–∫–æ–π –ø–æ–¥—Ö–æ–¥:
* –£—Å—Ç—Ä–∞–Ω—è–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫
* –ò—Å–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—Ö–æ–∂–¥–µ–Ω–∏—è –º–µ–∂–¥—É `DATABASE_URL` –∏ `TEST_DATABASE_URL`
* –î–µ–ª–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –±–æ–ª–µ–µ –ø—Ä–æ–∑—Ä–∞—á–Ω–æ–π

### üìã –ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–π

**–õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞** (.env.local):
```env
POSTGRES_USER=saasuser
POSTGRES_PASSWORD=saaspass
POSTGRES_HOST=db
POSTGRES_PORT=5432
POSTGRES_DB=saasdb




---




## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

* [–†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø—ã](docs/roles.md)
* [–ö–∞—Å–∫–∞–¥—ã –∏ —É–¥–∞–ª–µ–Ω–∏–µ](docs/db_cascades.md)
* [–ß–µ–∫–ª–∏—Å—Ç –∫–∞—Å–∫–∞–¥–æ–≤ (—Ä—É—á–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞)](docs/db_cascades_checklist.md)  
* [–ú–∏–≥—Ä–∞—Ü–∏–∏ –∏ CI/CD](docs/migrations.md)
* [Runbook ‚Äî —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è –±–æ—Ç–∞](docs/runbook.md)

---
# test CI trigger
